- [[[[endo]] [[LavaMoat]] Call]]
    - [[esm]] modules create round trips to load, and browsers seem to bottleneck at 6 simultaneous module requests.
        - [[[[endo]] bundler]] is one solution to this.
        - [[Mark Miller]] wants to avoid [[rollup]] to preserve the meaning of the JS project, as well as its security. Anything that loses the module separation has to play funny scoping games, and is at risk of violating the [[Secure EcmaScript (SES)]] security boundaries.
    - [[Compartment Mapper]] now using [[Guy Bedford]]'s lexer for [[esm]]
        - Far behind current head branch.
        - ~2k LOC
        - Hard to merge because [[Kris Kowal]] added
            - Typescript
            - Linted
            - Found & fixed some bugs
        - [[Test 262]]
    - [[endo]] milestone 1 needs a date
        - Will include both [[@agoric/import-bundle]] and [[@agoric/bundle-source]]
        - Question: Does using these modules provide us a suitable set of tools for bundling snaps? If not (expected), what are the problems we hit (so they can be fixed sooner).
        - https://github.com/MetaMask/metamask-snaps-beta/issues/170
    - [[TypeScript]] now supports re-exporting [[JSDoc]] types with some syntax like `export * from ....`
    - [[Agoric]] now running [[ses-shim]] within [[XS Engine]]
        - Will probably preserve their compartment as an evaluator instead of the eight magic lines.
    - [[Christine Lemmer Webber]] on cross platform [[CapTP]]
        - [[Baldur/Zarutian]] implemented [[[[Spritely]] Goblins]] [[CapTP]] in a fork of [[@agoric/capTp]] https://github.com/zarutian/agoric-sdk/blob/zarutian/captp_variant/packages/captp/lib/captp_goblins.js
            - Were able to open up Goblin-chat over tor onion services
            - Could we make a JS client that could interop with this?
                - Features
                    - JS version could look better
                    - JS version could share its own capabilities with Spritely Goblins
            - There's now a call for next week to have [[Spritely]], [[Agoric]], and [[Cap'n Proto]] to all come together and talk interoperability!
            - Questions
                - How much of the Agoric semantics were preserved?
                    - [[Baldur/Zarutian]] implemented [[[[Spritely]] Goblins]] [[CapTP]] in a fork of [[@agoric/capTp]] https://github.com/zarutian/agoric-sdk/blob/zarutian/captp_variant/packages/captp/lib/captp_goblins.js
                    - Mark says the changes look pleasingly small!
                - How much is the [[@agoric/capTp]] designed to interoperate with other languages?
                    - [[Mark Miller]] having done a few of these, there is a degree of language neutrality that is impossible, and a degree of moderate neutrality that is pleasant.
                        - Extreme neutrality
                        - The distributed object system itself has a semantics, and this semantics is very much a language design.
                            - Either this semantics draws from one language, giving that language an especially pleasant time, or it doesn't, and all languages have the same rough time, but without any languages having an especially pleasant time.
                        - Much of [[@agoric/capTp]] is smoothing for JavaScript, but may be rougher for other languages.
                            - round-tripping null, undefined, and false.
                                - JS is bizarre because it has these two "bottom values". Any other language would only have a null, but no undefined.
                                - Combining these into one would be just as bizarre as introducing a new one.
                                - For Agoric, it would've been painful to live with only one bottom value.
                            - [[AsyncIterator]] as a way of supporting better streaming via CapTP.
                                - Response to [[Greater Theory of Reactivity (GTOR)]]: [[Christine Lemmer Webber]] feels that [[Propogators]] may be an ideal "functional reactive programming" without anything within CapTP itself.
                            - Symbols
                                - A seemingly idiosyncratic language feature to support
                            - Messages having a method name
                                - in [[Scheme]] there is a question: Should methods be a first-class thing, or is the first-argument "the method name".
                            - The parts that are included in the `EncodingClass` in [[@agoric/marshal]]
                                - ibid
                                - bigint
                                - pass by copy
                                    - array
                                    - records
                                        - each element of which is a named field whose value is a passable
                                    - Errors
                                        - [[Christine Lemmer Webber]] points out there is value to having [[sealed]] errors, so only a debugger might have permission to view them (like a [[deep stack]])
                                        - Probably needs a revisit
                                        - Maybe every platform has its own error format, and that's ok.
                                - Goals are that we only copy things we would divulge to something untrusted.
                                    - Providing stack traces to help debugging should be done by other means, ie [[Causeway]]
                                - Types of things that are preserved by passing over the CapTP boundary
                                    - Remotable
                                    - Remote Presence
                                    - Promises
            - What could the cross-platform sticking points be?
                - Goblins currently has no distinction between a function and an object.
                    - Example
                        - Goblins has `agoric-func` and `agoric-obj`
                        - Chris would then `(<- agoric-func "arg1" "arg2")`, 
                    - Solutions
                        - [[Christine Lemmer Webber]] proposes that for goblins, if receiving an incoming message on an object, treat the first argument as the method name.
                            - Wouldn't be great for [[JavaScript]] because they want to support functions that can have additional methods available on them.
                                - This may be a concession worth making for the sake of the cross-platform compatibility story.
                        - Worst of all worlds option from [[Christine Lemmer Webber]]: Forcing goblins to have distinct semantics
                            - `(<-* agoric-func #f (list "arg1" "arg2"))`
                            - `(<-* agoric-obj 'foo (list "arg1" "arg2"))`
                        - Solution: Just allow the JS version to pass direct functions to allow simple function invocation.
                    - In JS, a func has a call behavior, and a func is an object that can have methods.
                        - If you provide `undefined` as a method name, instead of a method-name string, [[@agoric/capTp]] will treat this as a function call.
                    - [[@agoric/capTp]] currently strips the `this` value off of any functions for security reasons, so it's more like a bag of functions than a traditional object.
                    - [[esm]] has its roots in [[Racket]]: [[David Herman]] had the proposal (a counter to [[CommonJS]]) so there would be a path to [[hygienic macro]]s.
                    - [[Kris Kowal]] hopes an [[IDL]] will be optional, but languages will be able to write one if they want one.
                        - This is like the [[Lambda cubed]] thing: You can move from the typed to the untyped, and vice-versa. "You can always Godel something".
                            - [[Haskell]] people always say "my programs can never have these classes of problems!" [[Christine Lemmer Webber]]: "Have you written an emulator? What about those emulated programs?"
                - Build on [[Cap'n Proto]]?
                    - pros
                        - [[Sandstorm]] interop
                            - Could potentially be ported to a new protocol if we made one.
                    - cons
                        - They currently allow fully manual memory-management (remote deallocation), when actually just treating deallocation as a reference counter to enable automatic garbage collection is probably better and safer.
                        - There could just be adapters between protocols later anyways.
                            - CapTP is a membrane, and capnProto could be another membrane.
                        - You can't Godel this, because you can't build on top of it (since it's rigid), so we'd have to "break through its floor".
                            - Abstraction Barrier: Do not cross
                            - Read after write error: Do your homework first
            - [Spritely implementation readme](https://gitlab.com/spritely/syrup
)
                - Similar to [[NetString]] as [[Brian Warner]] likes.
                - Desirable JS changes
                    - We might want a modified version for CapTP JS to distinguish numbers from BigInts.
                - https://gitlab.com/spritely/syrup/-/blob/master/impls/racket/syrup/syrup.rkt#L29
