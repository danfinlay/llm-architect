- [[endo]] [[LavaMoat]] call
    - Topics
        - https://github.com/Agoric/SES-shim/pull/568
            - [[Mark Miller]] is mitigating [[the override mistake]] in this PR for a few properties.
            - This change is hopefully not breaking, but if it is breaking, it would introduce new "failed assignment" errors.
            - Currently in [[Secure EcmaScript (SES)]] `Date` and `Math` do the same whether `safe` or `unsafe`.
            - The `Date` compartment after lockdown has a `Date.now()` that will give you the current time. This is okay under ocap, because this isn't an shared object, it's just an initial power.
                - New compartments do not have the `.now()` method, so the parent compartment needs to pass in the Date object.
                - How does this avoid identity continuity issues?
                    - [[J.F. Paradis]] figured out: The `Date` constructor that is shared is a different object from the `Date` constructor in the parent environment. They point at the same `prototype`, which has a constructor that points at the safe of the two.
                    - This pattern does not interfere with `instanceof` at all! They all inherit from the shared `Date.prototype`.
                    - This is because the `instanceof` implementation takes the right operand, follows its `prototype`, then walks the inheritance chain of the left operand, and checks if it ever arrives at the same prototype.
            - `Function` has a similar trick.
                - The `Function` constructor evaluates within the global of its compartment, so they can't share a constructor. Every [[JavaScript Compartment]] has its own Function constructor.
                - But they share the same `Function` prototype, just with different constructors.
                - `Function.prototype.constructor` leads to a function that only throws.
                    - This in practice has broken no known code.
            - `Regexp.prototype.compile`
            - Locale taming
                - `toLocaleString()`
                - Hard to tame because it has a non-reproducibility.
                - Is not really a communication channel.
                - If you want to enable locale-specific behavior, you should enable `unsafe` here, but it's really a very tiny issue.
            - `console` taming
                - Whatever `console` is found in the start compartment (at time of `lockdown()`) we want to allow safe debugging.
                - If you say `unsafe` we leave the original console.
                - [[XS Engine]] did not have one
                - Mark would like to convince us
                    - consoleTaming: safe behavior, once you learn to read it, is strictly superior to the default console behavior, though somewhat different.
                - In [[Secure EcmaScript (SES)]] 0.12
                    - Includes [[Eventual Send]] for queuing messages to another object (remote or local).
                        - Integrates into the error stack, to allow for a sort of distributed error reporting.
                        - Uses `console.group` to allow nested distributed console logs, which Mark calls a [[deep stack]].
                    - [[stack filtering]]
                        - Currently there are so many stack frames from the [[Secure EcmaScript (SES)]] infrastructure that it's overwhelming to hunt through for the relevant stack frames.
                        - Integrates some ad-hoc rules for filtering out likely noise for likely signal to improve the usefulness of the stack.
                        - `stackFiltering: concise`
                            - Their [default filtering method](https://github.com/Agoric/SES-shim/blob/17aa9ebc923cf4c64fcf658b284af68c47e2d586/packages/ses/src/error/tame-v8-error-constructor.js#L61).
                            - [[Mark Miller]] wrote the most general set of rules that meet the needs of [[Agoric]], but aspires that we could create our own stack rules.
                            - Throws out
                                - [[Node.js]] environment stuff
                                    - Any `node_modules`
                                    - `internal`
                                    - `FILENAME_FILTER` is looking out for mono-repos, so if there is a bundle behind a `/packages/` path, just keep that last part, the actual module name.
                                - logging from the `assert.js` module internals, which are just passing forward an eventual error.
                        - `stackFiltering: verbose`
                            - Unmodified stack.
                    - Error taming
                        - `unsafe` preserves the stack in errors.
                    - recommendation for us to try
                        - `console:unsafe`
                        - `error:unsafe`
                        - `stackFiltering:verbose`
        - Would it be safe to allow a [[[[MetaMask]] Snaps]] to receive incoming connections from new sites without user consent?
            - If the user's model of the separate Snaps is that they are isolated in the absence of user isolation, then start there. [[principle of appropriate boundaries]]
            - In other cases, drag-and-drop has been a beautifully satisfying way for users to express the association of two agents and designating their authority.
        - It's unclear whether [[Salesforce]] is internally maintaining a [[Realm]] shim.
        - One sensible use for using [[JavaScript Compartment]] without lockdown()
            - To create one compartment, so that all of it is isolated from the global.
        - [[Intelligent Voluntary Cooperation]]
            - A book coming from [[Mark Miller]] [[Christine Peterson]], [[Allison Duettmann]]
            - [The first talk of a series promoting the book](https://www.youtube.com/watch?v=73sXSvUCzpI)
            - Thursday of the first week of every month, or the first thursday of every month they're giving a talk together.
                - Next talk is with [[Robin Hanson]]
                - Nobel-prize winning economists
                - [[Robert Axelrod]]
                - [[Daniel Ehlsberg]]
