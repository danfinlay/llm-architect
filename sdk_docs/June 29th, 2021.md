- [[[[endo]] [[LavaMoat]] Call]]
    - [[muji]] is passing [[Static Module Record]] tests in [[LavaMoat]] for [[swc]] in [[rust (language)]]
        - Has not been able to preserve line numbers
            - [[swc]] does not have the option to preserve line numbers. Doing so would require rewriting the whole codegen module.
            - Does the parse tree include line & column number?
                - Muji: No, a byte range
                    - [[Kris Kowal]]: that can be translated to line & column number if you have a parallel array of all the positions of the newlines.
                    - [[Mark Miller]] proposes a cheap hack: Check "is this AST the exact sub-tree as it was originally parsed? Are we at that line in the output? If so, just copy original text"
        - [[Kris Kowal]] is curious about the performance difference.
    - [[muji]] hit some [[swc]] bug that caused an infinite bug in its bundler, [[spack]]
        - Hits an infinite loop under some circumstances, is failing cycle detection.
        - Preventing building [[MetaMask]] under [[swc]]
        - Has reproduced the module graph for the lead [[swc]] developer, [[kdy1]], so it can be easily reproduced and debugged.
    - What are the next steps to applying least-authority linkage in [[endo]]? [[muji]]'s exposure to [[Static Module Record]] and [[Compartment Mapper]] puts him in a valuable position to explore.
        - Put [[Static Module Record]] stuff aside.
        - Do some analysis on bundling on [[LavaMoat]], and discover where they intersect from there.
        - Kris's instincts
            - The compartment map should be sufficiently expressive to be able to be the build target of the [[LavaMoat]] policy file and its build process.
                - MarkM considering some policy scenarios, to test the current tooling
                    - import namespace rewiring issues: When module X in a given package says `import y`, what does it get for `y`?
                        - Either this
                            - a given instance of something from another package
                            - an attenuated version of it, as expressed by a module.
                    - endowments
                    - global variables
                        - the entry point might say `global.x.y = z`
                            - What `x` it is? Is it constructed by copying some x, or 
                    - Any declarative policy language will have constraints on what it can express
                        - Since programmatic attenuators are expressed as modules, there is no loss of generality.
                - Building an attenuator for an ESM module can be tricky
                    - Because of [[live binding]]?
                    - The compartment mapper is the source of truth for the runtime.
                    - If you see a compartment mapper with one compartment per package, it may because the builder is building one compartment per module to express an attenuation.
            - We should work to make the bundler more sophisticated, while keeping the [[Compartment Map]] simple.
                - In [[Node.js]] we don't know what you'll import until you import, we just have a [[LavaMoat]] policy to enforce at runtime.
                - [[endo]] will not do the node-style thing of calling down into the synchronous [[CommonJS]] module loader. That feature won't be provided, and will limit compatibility, but mostly with code that hasn't been written. If we're fast to steer the course of the ecosystem, we can normalize modules that are friendly to async loading.
                - Compartment Map needs a feature that allows (even with a small string of JS) what modules to load
        - Endowments is maybe the biggest outstanding problem.
            - The module graph today (from [[LavaMoat]]) is simply `canModuleBeImported: boolean`. The module graph is the important part.
        - PropertyDescriptor transforms that wrap or unwrap the `this` value to the true global `this`.
        - Questions
            - Will loading a graph of modules require round trips on each additional layer of modules?
    - Some progress has been made towards formally verifying [[Jessie]]
    - [[TypeScript]] status
        - [[[[TypeScript]] is unsound]]
    - DanF: Question on language: [[object capability (ocap)]] vs [[rich sharing]], etc.
    - sestival
- [[soil]] [[Henry Driver]]
    - https://twitter.com/henrydriver_/status/1403362429560672259?s=21
