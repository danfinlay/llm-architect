- Resources
    - [Official EIP](https://eips.ethereum.org/EIPS/eip-4337)
    - [Aggregated resources page](https://eip4337.com/en/latest/resources.html)
    - [solidity implementation](https://github.com/eth-infinitism/account-abstraction/tree/develop/contracts)
    - [Soulwallet implementation](https://github.com/proofofsoulprotocol/soul-wallet-contract/blob/main/contracts/SoulWallet.sol)
    - [[Alchemy]] [blog post](https://www.alchemy.com//blog/account-abstraction)
- Terms
    - UserOperation
        - new tx type
        - struct
            - fields common to old types of tx
                - uint256 nonce
                    - open ended, up to individual Account Contract implementation.
                - bytes callData
                - uint256 callGasLimit
                - uint256 maxFeePerGas
                - uint256 maxPriorityFeePerGas
                - bytes signature
                    - open ended, up to individual Account Contract implementation.
            - Fields added in 4337
                - address sender
                    - since we can't necessarily derive the sender from a signature
                    - similar to the [1271 support](https://github.com/delegatable/delegatable-sol/pull/34) change added to Delegatable
                - bytes initCode
                    - used to publish this Account Contract if it is not yet deployed
                    - [[questions]]
                        - How does the EntryPoint know what address the Account Deployer is at to send this `initCode` to?
                            - The first 20 bytes of the initCode is used as the deployer address. ([source](https://github.com/eth-infinitism/account-abstraction/blob/5a1ad4072438d9e9f7c934b66464dc05a4b37d02/contracts/core/EntryPoint.sol#L282))
                            - The senderCreator is then asked to construct the sender with the initcode ([source](https://github.com/eth-infinitism/account-abstraction/blob/5a1ad4072438d9e9f7c934b66464dc05a4b37d02/contracts/core/EntryPoint.sol#L314))
                            - the rest of the initCode is then used as callData and sent to the deployer ([source](https://github.com/eth-infinitism/account-abstraction/blob/develop/contracts/core/SenderCreator.sol)).
                - uint256 verificationGasLimit
                    - Since verification can be expensive, like walking a delegation chain, which can be made up of many smaller delegations
                - uint256 preVerificationGas
                - bytes paymasterAndData
    - Wallet (Account)
        - Account Contract
            - required method
                - ```solidity
function validateUserOp(UserOperation userOp, bytes32 requestId, address aggregator, uint256 missingWalletFunds)```
                    - UserOperation
                    - requestId: Basically a hash of the userOp
                        - Gets signed to validate the signature
                    - address aggregator
                        - for signature aggregation, only applies to L2s?
                    - uint256 missingWalletFunds
                        - If no paymaster subsidizing, then the entrypoint must be paid this amount for the tx to succeed.
            - implementation-optional methods, used by [eth-infinitism/sdk](https://github.com/eth-infinitism/bundler/tree/main/packages/sdk)
                - ```javascript
function nonce() view returns (uint256);```
                - ```solidity
function execFromEntryPoint(address dest, uint256 value, bytes calldata func);```
        - Account Deployer
            - singleton factory contract
            - Can implement whatever interface it likes for deploying accounts: The UserOp's bytes initCode bytes[20:] will be sent to it as `callData`.
        - Account client
            - software for using the account
    - Paymaster
        - contracts that can optionally pay for txs instead of wallets themselves
    - EntryPoint
        - The global singleton for all UserOps to be submitted
        - methods
            - handleOps
        - Implementations
            - https://github.com/eth-infinitism/account-abstraction/blob/develop/contracts/core/EntryPoint.sol
- Sequence of on-chain flow
    - ![](https://firebasestorage.googleapis.com/v0/b/firescript-577a2.appspot.com/o/imgs%2Fapp%2Fcapabul%2FVCj8HdBEuW.03.24%20AM.png?alt=media&token=45994ec5-02fa-410a-a036-e10c9d31adff)
    - Someone calls handleOps with a batch of UserOperations
    - 
- Videos
    - https://www.youtube.com/watch?v=eyT6WzJmWyc
    - [4337 for Wallets Video talk](https://www.youtube.com/watch?v=xHWlJiL_iZA)
- What it does
    - No additional consensus changes
    - Defines [[User Operation]] object as a form of [[MetaTransaction]]
        - Equivalent to a [[invocation]] from [[Delegatable Eth]]
    - Has a concept of a "bundler", which is either:
        - A miner
        - users that can send transactions to miners through a bundle marketplace
            - What about users who just want to submit bundles for themselves? Is that not included?
    - Aspires to be [[[[EIP]] 2938: [[account abstraction (AA)]]]] without protocol changes
- claims
    - [[[[EIP]] 3074: Delegated Invocation Contracts]] requires keeping [[externally owned account (EOA)]]s around
        - Users can already use [[smart contract]] accounts without an [[externally owned account (EOA)]] today. The EOA is only required for gas payment, which seems to continue to be the case under 4337.
        - I would describe 3074 as an intermediate migration path, when combined with [[[[EIP]] 5003: AUTH_USURP]]
    - Avoids trust assumptions on bundlers
        - Why bother? Why not just let anyone submit a bundle, and let the normal anti-censorship systems (distributed validation) handle this?
- https://medium.com/infinitism/erc-4337-account-abstraction-without-ethereum-protocol-changes-d75c9d94dc4a
- By [[Vitalik Buterin]]
- Dictionary of terms relative to [[Delegatable Eth]]
    - `UserOperation`: `Invocation`
    - `Bundle`: `Invocations.batch`
    - `handleOps()`: `invoke()`
    - `nonce`: Not meant as a normal nonce!
        - https://twitter.com/VitalikButerin/status/1553877216953774082
